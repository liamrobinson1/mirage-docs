
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gallery/10-utility/kdtree_vs_balltree.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gallery_10-utility_kdtree_vs_balltree.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gallery_10-utility_kdtree_vs_balltree.py:


KDTree vs BallTree
==================

Benchmarking tree searches in :math:`R^3`

.. GENERATED FROM PYTHON SOURCE LINES 7-62

.. code-block:: Python


    import numpy as np
    import pyvista as pv
    from scipy.spatial import KDTree as ssKD
    from sklearn.neighbors import BallTree as skBT
    from sklearn.neighbors import KDTree as skKD

    import mirage as mr
    import mirage.vis as mrv


    def plot_kdtree(pl: pv.Plotter, tree):
        tree_data, index, tree_nodes, node_bounds = tree.get_arrays()

        bounds_boxes = np.zeros((node_bounds.shape[1], 6)) # xmin, xmax, ymin, ymax
        bounds_boxes[:,[0,2,4]] = node_bounds[0,:,:]
        bounds_boxes[:,[1,3,5]] = node_bounds[1,:,:]

        pl.add_mesh(
            pv.MultiBlock([pv.Box(bound) for bound in bounds_boxes]),
            line_width=1,
            style="wireframe",
            color="k",
        )

    def plot_balltree(pl: pv.Plotter, tree):
        tree_data, index, tree_nodes, node_bounds = tree.get_arrays()
        centers = node_bounds.squeeze()

        pl.add_mesh(
            pv.MultiBlock([pv.Sphere(radius=r[-1], 
                                     center=b,
                                     theta_resolution=30,
                                     phi_resolution=30) for r,b in zip(tree_nodes, centers)]),
            opacity=0.1,
            style='wireframe',
            color="k",
            line_width=0.1,
        )

    obj = mr.SpaceObject("stanford_bunny.obj")
    pts = obj.face_centroids

    mr.tic("sklearn KDTree build")
    kt = skKD(pts, 10)
    mr.toc()

    mr.tic("sklearn BallTree build")
    bt = skBT(pts, 10)
    mr.toc()

    mr.tic("scipy KDTree build")
    kt2 = ssKD(pts, 10)
    mr.toc()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Model file stanford_bunny.obj not found in current model folder ('/Users/liamrobinson/Documents/mirage/mirage/resources/models'), checking model repository...
    Attempting to download stanford_bunny.obj and its associated material file from the model repository...
    Requesting: https://raw.githubusercontent.com/ljrobins/mirage-models/main//accurate_sats/stanford_bunny.obj
    Requesting: https://raw.githubusercontent.com/ljrobins/mirage-models/main//accurate_sats/stanford_bunny.mtl
    Model files were downloaded successfully!
    Attempting to download spacelib.obj and its associated material file from the model repository...
    Requesting: https://raw.githubusercontent.com/ljrobins/mirage-models/main//accurate_sats/spacelib.mtl
    Model files were downloaded successfully!
    sklearn KDTree build: 1.59e-03 seconds
    sklearn BallTree build: 1.59e-03 seconds
    scipy KDTree build: 1.73e-03 seconds




.. GENERATED FROM PYTHON SOURCE LINES 63-64

Querying benchmarks

.. GENERATED FROM PYTHON SOURCE LINES 64-78

.. code-block:: Python


    qpts = mr.rand_points_in_ball(1.0, int(1e5))
    mr.tic()
    kt.query(qpts)
    mr.toc()

    mr.tic()
    bt.query(qpts)
    mr.toc()

    mr.tic()
    kt2.query(qpts)
    mr.toc()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Elapsed time: 3.91e-01 seconds
    Elapsed time: 2.64e-01 seconds
    Elapsed time: 6.00e-01 seconds




.. GENERATED FROM PYTHON SOURCE LINES 79-80

KDTree

.. GENERATED FROM PYTHON SOURCE LINES 80-94

.. code-block:: Python


    pl = pv.Plotter(window_size=(2*1080, 2*720))
    pl.camera.zoom(4.0)
    mrv.render_spaceobject(pl, obj)
    plot_kdtree(pl, kt)
    pl.show()

    # $$
    # BallTree

    pl = pv.Plotter(window_size=(2*1080, 2*720))
    pl.camera.zoom(4.0)
    mrv.render_spaceobject(pl, obj)
    plot_balltree(pl, bt)
    pl.show()


.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /gallery/10-utility/images/sphx_glr_kdtree_vs_balltree_001.png
          :alt: kdtree vs balltree
          :srcset: /gallery/10-utility/images/sphx_glr_kdtree_vs_balltree_001.png
          :class: sphx-glr-multi-img

    *

      .. image-sg:: /gallery/10-utility/images/sphx_glr_kdtree_vs_balltree_002.png
          :alt: kdtree vs balltree
          :srcset: /gallery/10-utility/images/sphx_glr_kdtree_vs_balltree_002.png
          :class: sphx-glr-multi-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 4.390 seconds)


.. _sphx_glr_download_gallery_10-utility_kdtree_vs_balltree.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: kdtree_vs_balltree.ipynb <kdtree_vs_balltree.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: kdtree_vs_balltree.py <kdtree_vs_balltree.py>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
