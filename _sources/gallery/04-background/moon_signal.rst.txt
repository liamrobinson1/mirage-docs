
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gallery/04-background/moon_signal.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gallery_04-background_moon_signal.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gallery_04-background_moon_signal.py:


Moonlight Signal
================

The background signal model due to scattered moonlight

.. GENERATED FROM PYTHON SOURCE LINES 7-52



.. image-sg:: /gallery/04-background/images/sphx_glr_moon_signal_001.png
   :alt: moon signal
   :srcset: /gallery/04-background/images/sphx_glr_moon_signal_001.png
   :class: sphx-glr-single-img





.. code-block:: default


    import pyspaceaware as ps
    import numpy as np
    import pyvista as pv

    pl = pv.Plotter()
    station = ps.Station()
    date = ps.now()
    station_pos_eci = station.eci_at_dates(date)
    (g_az, g_el) = np.meshgrid(
        np.linspace(0, 2 * np.pi, 200),
        np.linspace(0.1, np.pi / 2 - 0.1, 200),
    )
    look_dirs_eci_eq = np.array(
        [
            station.az_el_to_eci(az, el, date)
            for az, el in zip(g_az.flatten(), g_el.flatten())
        ]
    ).squeeze()
    obs_pos_eci_eq = np.tile(station_pos_eci, (g_az.size, 1))

    dates = np.tile(date, (g_az.size, 1))
    sm = ps.moonlight_signal(
        dates,
        look_dirs_eci_eq,
        obs_pos_eci_eq,
        t_int=station.telescope.integration_time,
        scale=station.telescope.pixel_scale,
        d=station.telescope.aperture_diameter,
    ).reshape(g_el.shape, order="f")

    obs_to_moon = ps.hat(
        ps.moon(ps.date_to_jd(dates.flatten())) - station_pos_eci
    )

    ps.scatter3(
        pl,
        look_dirs_eci_eq,
        scalars=sm.T.flatten(),
        cmap="plasma",
        point_size=10,
    )
    ps.scatter3(pl, obs_to_moon, color="grey", point_size=25)
    ps.two_sphere(pl)
    pl.show()


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  6.754 seconds)


.. _sphx_glr_download_gallery_04-background_moon_signal.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: moon_signal.py <moon_signal.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: moon_signal.ipynb <moon_signal.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
